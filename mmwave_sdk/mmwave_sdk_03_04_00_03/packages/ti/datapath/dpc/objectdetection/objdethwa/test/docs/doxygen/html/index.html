<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Unit Test for Object Detection using HWA</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<table width=100%>
<tr>
  <td bgcolor="black" width="1"><a href="http://www.ti.com"><img border=0 src="../../tilogo.gif"></a></td>
  <td bgcolor="red"><img src="../../titagline.gif"></td>
</tr>
</table>
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Unit Test for Object Detection using HWA </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="intro_sec"></a>
Introduction</h1>
<p>The data path processing on the radar chip for 1D, 2D and 3D processing consists of a coordinated execution between the R4/DSP, HWA and EDMA. This is demonstrated as part of object detection out of box demo on one or more devices. The demo runs in real-time and has all the associated framework for BSS control etc with it. There is need to have a stand-alone unit test like code that allows the data path to be excited in non real-time. This allows developer to use it as a debug/development aid towards eventually making the data path processing real-time with real chirping. Developer can easily step into the code and test against known input signals. Most of the documentation is therefore also shared and can be looked up in the demo documentation. Here we will only describe the test flow at the high level and document the test generator briefly. The test flow diagram is described in figure below. The DPC is configured in advance frame mode running 4 sub-frames at a time. Each sub-frame represents one unit test with different sensor and scene configuration parameters. In the loop test reads 4 unit test configurations from the reference file, executes them as one unit test per sub-frame, checks the results and repeats until the end of the reference file. The reference file is located in </p><pre class="fragment">ti\datapath\dpc\objectdetection\objdethwa\test\testdata </pre><div class="image">
<img src="object_detection_unit_test.png" alt="object_detection_unit_test.png"/>
<div class="caption">
Object detection test flow diagram</div></div>
<p> The unit test configuration parameters are defined by structure <a class="el" href="structframe_config__t__.html">frameConfig_t_</a> which consists of the sensor configuration <a class="el" href="structsensor_config__t__.html">sensorConfig_t_</a>, and the scene configuration <a class="el" href="structscene_config__t__.html">sceneConfig_t_</a> .</p>
<h1><a class="anchor" id="testGen"></a>
Test Generator</h1>
<p>The test generator allows user to set arbitrary number of objects artificially at desired range, doppler and azimuth bins, elevation angle and noise level so that output can be checked against these settings. It can generate one frame of data.</p>
<p>The test data generator is located in file: <code> ti\datapath\dpc\objectdetection\common\gen_frame_data.c </code> The function <a class="el" href="gen__frame__data_8c.html#a0d0b1ab94bfa6987fc2066d81fc0025c" title="Function Name : initFrameData. ">initFrameData()</a> initializes the structure <a class="el" href="structgen_frame_struc__t__.html">genFrameStruc_t_</a> with unit test parameters defined in <a class="el" href="structsensor_config__t__.html">sensorConfig_t_</a> , and <a class="el" href="structscene_config__t__.html">sceneConfig_t_</a> .</p>
<p>The function <a class="el" href="gen__frame__data_8c.html#a1628171a7ea08f857486741dcb59e03b" title="Function Name : genChirpData. ">genChirpData()</a> is called once per chirp interval and it generates reference signal composed of all targets. The reference signal of one target is generated as:</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ x_{k,m,l}(n)=A \exp (j2\pi\frac{f_R}{N_{RFFT}}n + j2\pi\frac{f_A}{N_{AFFT}}(m+m_{azim}(l)) + j\varphi_{elev}(l)+j2\pi\frac{f_D}{N_{Tx}N_{DFFT}}k) + noise \]" src="form_0.png"/>
</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ m_{azim}(l) = \{0,4,2\} \]" src="form_1.png"/>
</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \varphi_{elev}(l) = \left\{ \begin{array}{lr} 0 &amp; : l=0,1\\ \pi\sin(\phi_{deg} / 180 \cdot \pi) &amp; : l=2 \end{array} \right. \]" src="form_2.png"/>
</p>
<p>where</p><ul>
<li><img class="formulaInl" alt="$k$" src="form_3.png"/> is chirp index in the frame <img class="formulaInl" alt="$k=0,...,N_{Tx}N_{DFFT}-1$" src="form_4.png"/>,</li>
<li><img class="formulaInl" alt="$m$" src="form_5.png"/> is receive antenna index <img class="formulaInl" alt="$m=0,...,N_{Rx}-1$" src="form_6.png"/>,</li>
<li><img class="formulaInl" alt="$l$" src="form_7.png"/> is transmit antenna index <img class="formulaInl" alt="$l=0,...,N_{Tx}-1$" src="form_8.png"/>,</li>
<li><img class="formulaInl" alt="$n$" src="form_9.png"/> is sample index inside the chirp <img class="formulaInl" alt="$n=0,...,N_{ADC}-1$" src="form_10.png"/>,</li>
<li><img class="formulaInl" alt="$f_{R}$" src="form_11.png"/> is expected peak index in the range FFT</li>
<li><img class="formulaInl" alt="$f_{D}$" src="form_12.png"/> is expected peak index in the Doppler FFT</li>
<li><img class="formulaInl" alt="$f_{A}$" src="form_13.png"/> is expected peak index in the azimuth FFT</li>
<li><img class="formulaInl" alt="$\phi_{deg}$" src="form_14.png"/> is expected elevation angle in degrees</li>
<li><img class="formulaInl" alt="$N_{ADC}$" src="form_15.png"/> is number of ADC chirp samples,</li>
<li><img class="formulaInl" alt="$N_{RFFT}$" src="form_16.png"/> is number of range bins, (range FFT size)</li>
<li><img class="formulaInl" alt="$N_{AFFT}$" src="form_17.png"/> is number of angle bins (azimuth FFT size)</li>
<li><img class="formulaInl" alt="$N_{Tx}$" src="form_18.png"/> is number of Tx antennas</li>
<li><img class="formulaInl" alt="$N_{Rx}$" src="form_19.png"/> is number of Rx antennas</li>
<li><img class="formulaInl" alt="$N_{DFFT}$" src="form_20.png"/> is number of Doppler bins (Doppler FFT size) </li>
</ul>
</div></div><!-- contents -->
<hr size="1"><small>
Copyright  2020, Texas Instruments Incorporated</small>
</body>
</html>
