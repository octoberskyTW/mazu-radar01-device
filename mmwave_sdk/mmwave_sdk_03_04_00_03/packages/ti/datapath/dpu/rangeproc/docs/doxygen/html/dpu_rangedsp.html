<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>RangeProcDSP</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<table width=100%>
<tr>
  <td bgcolor="black" width="1"><a href="http://www.ti.com"><img border=0 src="../../tilogo.gif"></a></td>
  <td bgcolor="red"><img src="../../titagline.gif"></td>
</tr>
</table>
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">RangeProcDSP </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#toplevel_dsp">Top Level Design</a></li>
<li class="level1"><a href="#config_dsp">Data Interface Parameter Range</a></li>
<li class="level1"><a href="#input_dsp">Data Input</a></li>
<li class="level1"><a href="#output_dsp">Data Output</a></li>
<li class="level1"><a href="#process_dsp">Data Processing</a><ul><li class="level2"><a href="#calibDC_Range_dsp">Antenna coupling signature removal</a></li>
</ul>
</li>
<li class="level1"><a href="#details_dsp">Use Cases</a><ul><li class="level2"><a href="#dsp_usecase_overview">General Information</a></li>
<li class="level2"><a href="#dsp_usecase1">Non-Interleaved RX channel data(1 or 2 TX Antenna) -&gt; DPIF_RADARCUBE_FORMAT_1</a></li>
<li class="level2"><a href="#dsp_usecase2">Non-Interleaved RX channel data(3 TX Antenna) -&gt; DPIF_RADARCUBE_FORMAT_1</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="toplevel_dsp"></a>
Top Level Design</h1>
<p>RangeProcDSP has 3 stages in its processing:</p><ul>
<li>Bring in ADC data through dataIn EDMA channels</li>
<li>FFT processing using DSPlib/mmwavelib</li>
<li>Transfer FFT results to radar cube through dataOut EDMA channels</li>
</ul>
<p>The following diagram shows the top level design for rangeProcDSP.<br />
 </p><div class="image">
<img src="rangeprocdsp_toplevel.png" alt="rangeprocdsp_toplevel.png"/>
<div class="caption">
rangeProcDSP Top Level</div></div>
<h1><a class="anchor" id="config_dsp"></a>
Data Interface Parameter Range</h1>
<p>Here are the supported ADCBuf and radarCube interface configurations:</p>
<h2>ADCBuf Data Interface </h2>
<table class="doxtable">
<tr>
<th align="left">Parameter </th><th align="center">Supported value  </th></tr>
<tr>
<td align="left">dataFmt </td><td align="center">DPIF_DATAFORMAT_COMPLEX16_IMRE ONLY </td></tr>
<tr>
<td align="left">interleave</td><td align="center">non-interleave ONLY </td></tr>
<tr>
<td align="left">numChirpsPerChirpEvent</td><td align="center">As ADCBuf memory permit </td></tr>
<tr>
<td align="left">numRxAntennas</td><td align="center">1, 2, 4 </td></tr>
<tr>
<td align="left">numAdcSamples</td><td align="center">64 - 2048 (even number only) </td></tr>
</table>
<h2>Radar Cube Data Interface </h2>
<table class="doxtable">
<tr>
<th align="left">Parameter </th><th align="center">Supported value  </th></tr>
<tr>
<td align="left">dataFmt </td><td align="center">DPIF_DATAFORMAT_COMPLEX16_IMRE ONLY </td></tr>
<tr>
<td align="left">layoutFmt </td><td align="center">DPIF_RADARCUBE_FORMAT_1 </td></tr>
<tr>
<td align="left">numTxAntennas</td><td align="center">1, 2 and 3 </td></tr>
<tr>
<td align="left">numRangeBins</td><td align="center">64 - 2048 </td></tr>
<tr>
<td align="left">numChirpsPerFrame</td><td align="center">As ADCBuf and HWA memory permit </td></tr>
</table>
<h1><a class="anchor" id="input_dsp"></a>
Data Input</h1>
<p>RangeProcDSP DPU transfers ADCBuf data through dataIn EDMA channels in ping/pong alternate order to FFT input scratch buffer - adcDataIn.</p>
<h1><a class="anchor" id="output_dsp"></a>
Data Output</h1>
<p>RangeProcDSP DPU transfer FFT results in scratch buffer(fftOut1D) to radarCube through dataOut EDMA channels in ping/pong alternate order.</p>
<h1><a class="anchor" id="process_dsp"></a>
Data Processing</h1>
<p>Range FFT processing is done by using DSPlib and mmwavelib APIs. FFT input data is stored in input scratch buffer - adcDataIn, its output data is stored in output scratch buffer - fftOut1D.</p>
<p>As shown in the following diagram, for every chirp event <a class="el" href="group___d_p_u___r_a_n_g_e_p_r_o_c___e_x_t_e_r_n_a_l___f_u_n_c_t_i_o_n.html#ga2fdf65ed747281edb1ac9aa23394faab">DPU_RangeProcDSP_process</a> is called to process the data in ADCBuf buffer. If the hardware resources or data interfaces are changed for next frame, <a class="el" href="group___d_p_u___r_a_n_g_e_p_r_o_c___e_x_t_e_r_n_a_l___f_u_n_c_t_i_o_n.html#ga325ba2a721182c2a2c968fd73d6f7b5c">DPU_RangeProcDSP_config</a> can be called before the next frame starts.</p>
<p>DC signal removal configuration can be updated at inter-frame time before the next frame starts.</p>
<div class="image">
<img src="dsp_callflow.png" alt="dsp_callflow.png"/>
<div class="caption">
rangeProcDSP call flow</div></div>
<h2><a class="anchor" id="calibDC_Range_dsp"></a>
Antenna coupling signature removal</h2>
<p>This feature is controlled through configuration <a class="el" href="group___d_p_u___r_a_n_g_e_p_r_o_c___e_x_t_e_r_n_a_l___d_a_t_a___s_t_r_u_c_t_u_r_e.html#ga95abfbaedd9cb13f4a02e770f3ab0e08">DPU_RangeProc_CalibDcRangeSigCfg</a>. The configuration can be sent to rangeProc DPU through API <a class="el" href="group___d_p_u___r_a_n_g_e_p_r_o_c___e_x_t_e_r_n_a_l___f_u_n_c_t_i_o_n.html#ga325ba2a721182c2a2c968fd73d6f7b5c">DPU_RangeProcDSP_config</a>. <br />
 The configuration can also be updated at runtime through control command <a class="el" href="group___d_p_u___r_a_n_g_e_p_r_o_c___e_x_t_e_r_n_a_l___d_a_t_a___s_t_r_u_c_t_u_r_e.html#ggaabd17f12617f8e65adc87dbc5056d37aa1ae008f0759c6ef17313799cf8f5ab66">DPU_RangeProcDSP_Cmd_dcRangeCfg</a>.</p>
<p>DC signal calibration and compensation is operated on fftOut1D data buffer for every chirp event.</p>
<div class="image">
<img src="dsp_dcremoval.png" alt="dsp_dcremoval.png"/>
<div class="caption">
rangeProcDSP Antenna DC signal removal</div></div>
<h1><a class="anchor" id="details_dsp"></a>
Use Cases</h1>
<h2><a class="anchor" id="dsp_usecase_overview"></a>
General Information</h2>
<p>This Section describes some of the internal implementation for a few use cases for different number of TX antenna.</p>
<p>Regardless of number of TX antennas, 2 input EDMA channels and 2 output EDMA channels are needed for range FFT to work in ping/pong manner. Ping input channel brings data into Ping region of local memory "adcDataIn", pong channel brings data into pong region.</p>
<p>After FFT, for 2 TX antenna, ping results in local memory "fftout1D" are copied to TX1 region in radar cube. Pong results are copied to TX2 region in radar cube.<br />
 For 3 TX antenna, ping always handles the odd chirp data, pong always handle even chirp data. Range FFT results are copied to radar cube in following format:<br />
</p><pre class="fragment">    TX1 region holds data for chirp index = 3 * (dopplerChirpIdx - 1) +1
    TX2 region holds data for chirp index = 3 * (dopplerChirpIdx - 1) +2
    TX3 region holds data for chirp index = 3 * dopplerChirpIdx

    chirp index is in range [1,numChirpsPerFrame]
    dopplerChirpIdx is in range [1, numDopplerChirps = numChirpsPerFrame/numTxAntennas]
</pre><h2><a class="anchor" id="dsp_usecase1"></a>
Non-Interleaved RX channel data(1 or 2 TX Antenna) -&gt; DPIF_RADARCUBE_FORMAT_1</h2>
<p>This use case is for configuration with with 1 or 2 TX antenna(diagram shows 2 TX antenna) with format:<a class="el" href="group___d_p_i_f___r_a_d_a_r_c_u_b_e___f_o_r_m_a_t.html#ga4f1cc2e5019a697f3cafa1cecdf3b144">DPIF_RADARCUBE_FORMAT_1</a>.</p>
<table class="doxtable">
<tr>
<th align="left">Input params </th><th align="center">Setting  </th></tr>
<tr>
<td align="left">InterleaveMode </td><td align="center">Non-Interleave </td></tr>
<tr>
<td align="left">RadarCube format</td><td align="center">DPIF_RADARCUBE_FORMAT_1 </td></tr>
<tr>
<td align="left">numTxAnt</td><td align="center">1, 2 </td></tr>
</table>
<div class="image">
<img src="dsp_2tx.png" alt="dsp_2tx.png"/>
<div class="caption">
2 TX Non-interleaved data input to DPIF_RADARCUBE_FORMAT_1</div></div>
<h2><a class="anchor" id="dsp_usecase2"></a>
Non-Interleaved RX channel data(3 TX Antenna) -&gt; DPIF_RADARCUBE_FORMAT_1</h2>
<p>This use case is for configuration with with 3 TX antenna with format:<a class="el" href="group___d_p_i_f___r_a_d_a_r_c_u_b_e___f_o_r_m_a_t.html#ga4f1cc2e5019a697f3cafa1cecdf3b144">DPIF_RADARCUBE_FORMAT_1</a>.</p>
<table class="doxtable">
<tr>
<th align="left">Input params </th><th align="center">Setting  </th></tr>
<tr>
<td align="left">InterleaveMode </td><td align="center">Non-Interleave </td></tr>
<tr>
<td align="left">RadarCube format</td><td align="center">DPIF_RADARCUBE_FORMAT_1 </td></tr>
<tr>
<td align="left">numTxAnt</td><td align="center">3 </td></tr>
</table>
<div class="image">
<img src="dsp_3tx.png" alt="dsp_3tx.png"/>
<div class="caption">
3TX Non-interleaved data input to DPIF_RADARCUBE_FORMAT_1</div></div>
</div></div><!-- contents -->
<hr size="1"><small>
Copyright  2020, Texas Instruments Incorporated</small>
</body>
</html>
